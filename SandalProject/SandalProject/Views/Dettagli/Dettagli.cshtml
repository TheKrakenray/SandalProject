@using SandalProject.Models;
@using SandalProject.Controllers;
@model List<Sandali>;
@{
    Layout = "MainLayout";
}
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sweaty Sandals - Product Page</title>
    <link rel="stylesheet" href="~/css/Dettagli.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
        <div class="product-container">
            <div class="image-grid">
                <img src="/Dettagli/GetImage?id=@Model.First().Id&posizioneLista=0" alt="Image 1">
                <img src="/Dettagli/GetImage?id=@Model.First().Id&posizioneLista=1" alt="Image 2">
                <img src="/Dettagli/GetImage?id=@Model.First().Id&posizioneLista=2" alt="Image 3">
                <img src="/Dettagli/GetImage?id=@Model.First().Id&posizioneLista=3" alt="Image 4">
            </div>
            <div class="product-details">
                <div class="titolo">
                @{
                    string nome = @Model.First().Nome;
                    nome = nome.Remove(0, 1);
                    nome = nome.Remove(nome.Length - 1, 1);
                }
                    <h2>@nome - €@(Model.First().Prezzo.ToString().Replace(".", ","))</h2>

                    <p href="/WList/InserisciWList/@(Model.First().Id)" class="far fa-heart" id="heart-icon" onclick="toggleHeart()"></p>
                    <!--Controllare se l'utente loggato ha wishlistato il sandalo-->
                </div>

                <div class="color-selection">
                    <p>Colore: </p>
                    <div class="colori">
                        
                    @for (int i = 0; i < Model.Count; i++)
                    {
                        if(i == 0 )
                        {
                            <span class="colore" id="selected" style="--coloreSandalo:@Model.ElementAt(i).Colore"></span>

                        }
                        else
                        {
                            <span class="colore" id="@Model.ElementAt(i).Id" style="--coloreSandalo:@Model.ElementAt(i).Colore"></span>
                        }
                    }
                </div>
                </div>

                <div class="size-selection">
                    <p>Taglia:</p>
                    <div class="sizes">
                    @{
                        List<int?> listTaglie = new();
                    }
                    @for (int i = 0; i < Model.Count; i++)
                    {
                        if (!listTaglie.Contains(Model.ElementAt(i).Taglia) && Model.ElementAt(i).Taglia != null)
                        {
                            listTaglie.Add(Model.ElementAt(i).Taglia);
                            <span>@Model.ElementAt(i).Taglia</span>
                        }
                    }
                    </div>
                </div>

                <button href="/Carrello/AggiungiCarrello/@Model.First().Id" class="add-to-cart">Aggiungi al carrello</button>
                

            @{
                string itemDesc = string.IsNullOrEmpty(Model.First().Descrizione) ? "default|default|default" : Model.First().Descrizione;
                itemDesc = itemDesc.Replace("''", "'");
                itemDesc = itemDesc.Remove(0,1);
                itemDesc = itemDesc.Remove(itemDesc.Length - 1,1);


                List<string> listDesc = itemDesc.Split('|').ToList();

                string description = listDesc.ElementAt(0);

                string details = listDesc.ElementAt(1);

                string specifications = listDesc.ElementAt(2);

            }


            <div class="description">
                @{

                    string[] descriptionArr = description.Split(";;");
                        <h3>@descriptionArr[0]</h3>
                        <p>@descriptionArr[1]</p>
                    }
                </div>

                <div class="details">
                    @{
                        string[] detailsArr = details.Split(";;");
                        <h3>@detailsArr[0]</h3>
                        <ul>
                        @{
                            Dictionary<string, string> detailsTable = new();


                            for(int i = 1; i < detailsArr.Length; i++)
                            {
                                
                                string key = "";
                                string value = "";

                                bool isValue = false;
                                foreach (char c in detailsArr[i])
                                {
                                    if (!isValue)
                                        key += c;
                                    else
                                        value += c;

                                    if (c == ':')
                                        isValue = isValue ? false : true;
                                    
                                }
                                detailsTable.Add(key, value);
                            }
                        }
                        @foreach(KeyValuePair<string,string>detail in detailsTable)
                        {
                            <li><strong>@detail.Key</strong> @detail.Value</li>
                        }

                        </ul>
                    }
                </div>

                <div class="specifications">
                    @{
                        string[] specificationsArr = specifications.Split(";;");
                        <h3>@specificationsArr[0]</h3>
                    }
                    <ul>
                        @for (int i = 1; i < specificationsArr.Count(); i++)
                        {
                            <li>@specificationsArr[i]</li>
                        }
                    </ul>
                </div>
            </div>
        </div>
    <script src="~/js/Elenco/Dettagli.js"></script>
</body>
</html>