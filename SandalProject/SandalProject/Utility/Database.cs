using Microsoft.AspNetCore.Mvc;
using SandalProject.Models;
using System.Data;
using System.Data.SqlClient;
using System.Diagnostics;
using System.Drawing;
using System.Text.RegularExpressions;

namespace SandalProject.Utility
{
    public class Database
    {
        private bool _creato = false;

        public bool Creato { get => _creato; }

        private SqlConnection Connection { get; set; }
        private static Database instance = null;

        private string nomeDB = "master";

        private Database(string nomeDB, string server = "localhost")
        {
            this.nomeDB = nomeDB;

            Connection = new SqlConnection($"Server={server};Integrated security=true;");
            //connessione al db master
            try
            {//controllo di esistenza del db richiesto
                Connection.Open();
                SqlCommand cmd = new SqlCommand($"USE {nomeDB}", Connection);
                cmd.ExecuteNonQuery();
                _creato = true;
            }
            catch (Exception ex)
            {//se il db non esiste, genera un eccezione, allora lo creiamo
                Console.WriteLine("creazione db in corso");
                string query = $"CREATE DATABASE {nomeDB}";
                SqlCommand cmd = new SqlCommand(query, Connection);
                cmd.ExecuteNonQuery();
                cmd = new SqlCommand($"USE {nomeDB}", Connection);
                cmd.ExecuteNonQuery();
                Connection.Close();
                //connessione al nostro db
                Connection = new SqlConnection($"Server={server};Database={nomeDB};Integrated security=true;");
                try
                { //creazione delle tabelle
                    CreaTabelle();
                }
                catch
                {
                    Console.WriteLine("Errore durante la creazione delle tabelle: " + ex.Message);
                }
                //il db non era già creato in precedenza
                _creato = false;
            }
            finally
            {
                Connection.Close();//precauzione
                                   //aggiorna la connessione da master a db corrente se necessario
                Connection = new SqlConnection($"Server=localhost;Database={nomeDB};Integrated security=true;");
            }
        }

        public static Database GetInstance()
        {
            if (instance == null)
                instance = new Database("ProjectSandal");

            return instance;
        }

        public List<Dictionary<string, string>> Read(string query)
        {
            List<Dictionary<string, string>> ris = new List<Dictionary<string, string>>();

            using (SqlConnection conn = new SqlConnection(Connection.ConnectionString))
            {
                conn.Open();
                SqlCommand cmd = new SqlCommand(query, conn);
                using (SqlDataReader dr = cmd.ExecuteReader())
                {
                    while (dr.Read())
                    {
                        Dictionary<string, string> riga = new Dictionary<string, string>();

                        for (int i = 0; i < dr.FieldCount; i++)
                        {
                            var columnName = dr.GetName(i).ToLower();
                            object columnValue = dr.GetValue(i);

                            if (columnValue is byte[] byteArray)
                            {
                                string byteValues = BitConverter.ToString(byteArray);
                                riga.Add(columnName, byteValues);
                            }
                            else
                            {
                                riga.Add(columnName, columnValue.ToString());
                            }
                        }

                        ris.Add(riga);
                    }
                }
            }

            return ris;
        }

        public Dictionary<string, string> ReadOne(string query)
        {
            try
            {
                return Read(query)[0];
            }
            catch
            {
                return null;
            }
        }

        public bool Update(string query)
        {
            try
            {
                Connection.Open();
                //Console.WriteLine("connessione a:" + Connection.Database);

                SqlCommand cmd = new SqlCommand(query, Connection);
                //Statistiche(Connection,query);

                int affette = cmd.ExecuteNonQuery();

                //Console.WriteLine("Righe affette: " + affette);

                return affette > 0;
            }
            catch (SqlException e)
            {
                Console.WriteLine(e.Message);
                Console.WriteLine($"\nQUERY ERRATA:\n{query}");

                return false;
            }
            catch (Exception e)
            {
                Console.WriteLine("Errore generico" + "\n" + e.Message);
                return false;
            }
            finally
            {
                Connection.Close();
            }
        }

        public void Statistiche(SqlConnection connection, string query = "")
        {
            Console.WriteLine($"{connection.State}\t {connection.Database}\t {connection.DataSource}"); //\t{(query = query == "" ? "query non trovata" : query)}
            //Console.ReadKey();
        }

        public void DropDB(string query, string server = "localhost")
        {
            Connection = new SqlConnection($"Server={server};Database=master;Integrated security=true;");
            try
            {
                Connection.Open();
                //Console.WriteLine("connessione a:" + Connection.Database);

                string closeConnectionsQuery = $"ALTER DATABASE {nomeDB} SET SINGLE_USER WITH ROLLBACK IMMEDIATE;";
                SqlCommand cmd = new SqlCommand(closeConnectionsQuery, Connection);
                cmd.ExecuteNonQuery();
                //Statistiche(Connection,query);

                cmd = new SqlCommand(query, Connection);
                cmd.ExecuteNonQuery();
            }
            catch (SqlException e)
            {
                Console.WriteLine(e.Message);
                Console.WriteLine($"\nQUERY ERRATA:\n{query}");
            }
            catch (Exception e)
            {
                Console.WriteLine("Errore generico" + "\n" + e.Message);
            }
            finally
            {
                Connection.Close();
            }
        }

        private void CreaTabelle()
        {
            //query creazione tabelle
            Update("create table Account\r\n(\r\n\tid int primary key identity(1,1),\r\n\tpropic varbinary(max),\r\n\tusername varchar(50),\r\n\temail varchar(50),\r\n\tpsw varchar(200),\r\n\truolo varchar(20),\r\n\tpfedelta int\r\n);");
            Update("create table Sandali\r\n(\r\n\tid int primary key identity(1,1),\r\n\tnome varchar(50),\r\n\tmarca varchar(50),\r\n\tdescrizione varchar(1000),\r\n\tprezzo decimal,\r\n\tSKU varchar(100),\r\n\tcategoria varchar(20),\r\n\tgenere varchar(10),\r\n\tsconto decimal,\r\n\tquantita int,\r\n\ttaglia int,\r\n\timmagine1 varbinary(max),\r\n\timmagine2 varbinary(max),\r\n\timmagine3 varbinary(max),\r\n\timmagine4 varbinary(max),\r\n\tcolore varchar(10));");
            Update("create table Carrello\r\n(\r\n\tid int primary key identity(1,1),\r\n\tidAccount int,\r\n\tFOREIGN KEY(idAccount) REFERENCES Account(id) \r\n\tON UPDATE CASCADE ON DELETE SET NULL,\r\n\tidSandali int,\r\n\tFOREIGN KEY(idSandali) REFERENCES Sandali(id) \r\n\tON UPDATE CASCADE ON DELETE SET NULL);");
            Update("create table Wishlist\r\n(\r\n\tid int primary key identity(1,1),\r\n\tidAccount int,\r\n\tFOREIGN KEY(idAccount) REFERENCES Account(id) \r\n\tON UPDATE CASCADE ON DELETE SET NULL,\r\n\tidSandali int,\r\n\tFOREIGN KEY(idSandali) REFERENCES Sandali(id) \r\n\tON UPDATE CASCADE ON DELETE SET NULL,\r\n\tskuSandali varchar(100) );");

            Update("Insert into Account\r\n(Propic, Username, Email, Psw, Ruolo, PFedelta)\r\nValues \r\n(0xFFD8FFE000104A46494600010100000100010000FFDB00840009060712121215121212151515171712151210101210151515151515161615121515181D2820181A251D151521312125292B2E2E2E171F3338332D37282D2E2B010A0A0A0E0D0E1B10101A2B251F222D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D372B372B372D2D2BFFC000110800E100E103012200021101031101FFC4001B00000105010100000000000000000000000100020304050607FFC4003C100002010204040404020903050100000000010203110405122106314151132261713242819152B107141523627292A1C1334353172482D1E116FFC4001A010001050100000000000000000000000000010203040506FFC40026110002020202020203010003000000000000010203041112210531134114225132152371FFDA000C03010002110311003F00F411086B242D02C14215C0415C6C8235B000A1C32E390083EC0D21466F11E29D3C3D49AE6909E854439971161E86D3A914FB5CAF85E2CC34DA4A6B7EB73C667879E22A39CDB576EC99AB82CB1D2DF9FBA295D92A24F5D0E67AFE3F38A54A9EBD49F6499C1E6FFA499A7A6952BDB9BDCCEAB6704D377E5A6EED7F629C72EDDDA3D4AFF9858FC36747907E905D49AA7561A5B764CF408B4CF13C5E0B4E99A5E68CAFED63D5F20CC154A51BB4A5649ABFA162AC95221BB15C16CD5681623AD5947793B069D64F93D8B89FDA2A324044221E341705C4040204CECEE56A6EE683327892FE0BB778FE602A2CD0F857D09910D1F857B22410B0BD0F424350E88031D6102E101A680D6398248068C63641DC160006A0A0582002B0A2C17034001A959455D98B8BC742AEAA329249DCBF8F93B592B9E77C6B4FC3B3553CEDFC30E84364F4858ADB293C2538CE4AF7D3276B334A861A538F9B65D118590C652A894BDDDCED610BA497639CCC9B52E8DEC48FEA7398DC0DA51516F7FEC5DFD97B7C4F5771D884FC64BB234D44AD65AE29175411CDE22535FBB92BEF65263F31A7528C23529C9A9452BAE869E6B04E17DAEAD61894AAC128D36F6DEFC89EBB7D32BDDC75A30EA719D5AAA30973BD9BB247A0E4346A38464E5B33849E4708CAF38B8BBFD3E86D706677A6ACB0F396D7F25CD9C7C9527A4625F535D9DEC589A0442CD24F68A4C084C484C03631AEA67E751FDDFD63F99A467673F07D57E620A8923C905017400A584B487A258914512C00490FB08221466CBCC6B438027A22D806B43EE20D8E4C6A88A511D71AE42392D0BEC6340663679C450A1E55E69F65B9852CD3155775250454B732BADF65AAF1A72FA3ACC754D1094BB2673584E1F588B55AAAF7BB4BD3A19B8FAF8AF0E5AAA268D3CA73EA73A4A0AA689256DFB99B9592EC5B813C6870F652CFF21742709D18D93D9ABF225C4D1C4D3A6A4E8EA4D2DE0EE5BA78F552F4710EE9FC3345FC147154A36A528D5825B465D8CE8CD49EA64AA538FA38B93ACAAC65E04FCCB64F635BF67E3A72515474A76DE5D0399666E559C7132706ADA14392F42EE499AE3251968B4A37F2CA7CEC5C70AF5E81DD615338C83C18454E7AAA4DA4A29FDD9BF89953C2E1D3B5DD924BBB2854FDDDAB6227AAA2F8629DED7E88CD8E3275EA46535E44EF18B29CDA7FF82FC7397668E71055F0ADCA293B370E8D58F30C3BA94EBC2A37D52BFA5CEEF3CCDEA49385AD0EF6E87338DC6D19C7C34BCE9AB48B389394073A1B8E99EA5431D4FC38B72B5D75688AA67B878F3A88E2F078194E2BC49B6ADB24CB54B05087CB7F7DCB13F25C7A238F8FDFB3ACA59DD096CAA2FA972155495E2D3F6387AB9741EFA6DEDD014B13570AD4B53943969EC3A9F26A52D3196F8F715B477865E79B417F322DE598F856829C5DD755D9FA9578857EED7F344D685B192D99EEB947D922E9EC8361B0E4BD90E44C48BD0F812C48A0491602487EAF408840465FB0DB0F18C19101B004A398E650A29CA6D2DB657219CD47D8F841C9F45A9C8E678A338946D469CAD293B3DBA142AF10626B7C09421D24F9B2A52C249D575272D4FB999939A945A8B3531F11F2DB1F87C028EEFCD27BB93DCB7142B8D9339C959293ED9BF1AA290CC4D3D5171F73858E0AA46BD9773AC9D7A8DDA0ADEA08E54E4F54E7B9771ECF893E5F645652A44D0A6A518A9735D50EA54EAC5F92AC92F720964FDA7220961B110F85EA43769FA61F12D7A2DFEC8527294E5A9BEAFA325852AAA3A555697644584CC92F2C938BECC9AB6252E5BBEC88DCAC4F40A98FDA151A1A5DDBD4FBB64B89ACA2AEF6B762BA85496F7B7A1253C1AB35257F718DF7DB2555E9745396654AA4249BB73E673D9265A9D572E899D5BCB697E05EFB917ECD8C5DE3B7DCB31C88462D47EC6BAB6FB2E538D90E1B1561C8A126F64AA292134475A9A92B324624353D3D84A29A31B0D86AB194A30A8E2B9A4B91354FD6E31BF88A4B6F2BF434F4A158BB1CD9C59567891921B9767F193D134E33D959FF00837E0CE5B17808CF7EBD25D6E5BC87346EF0A8FCD17B5F9B46D61E7AB3A66664E22AFB4745164912184AE488D75E8CE9224B086EB10119AAC6B09063710A11726F921B63E88A0B6CA3996754A927796E96E8E37C5962EA3AB51F916D0874F722A70F16AD49CB74E575D8D2A74F4AB2D8C1CDCAD746DE2627DB428C3A212A3BB77FA0FB053E661FC8DBD9B0ABD0C7249D9BDC758CFC6CBF7B0F734131671D24C962051F41C209136C50213081A1622143339452DD2BFB0FC1E1ACAF6DD9573277A908FD4D58966CDC608022104AAD8A36E26160D21B01B7021CD15B1751C527EA3E2B90169A00D84EE83711AD0043A46B7D46D3AB7BD834C091A29E3F0EB4CA51DA56DA4B996C6C912556384B688AC827126E13C6EB8696EF25CEE6F44E13112951A8AA53DADF125D5763B1CBF16AA42335D4EB30EFE7139CC9A9C645BBA10AE02EECADA35AE70DC4D98CAAD6F020FCB1BEAB1D4E778CF068CA77DEDB7B9C565506D4A72F8A4DC9BF729790BB8409F06AE73ECB7429A8C524496124168E4676393DB3A68C5457401AD10E3EBB846EBD096136D27B5EDDD0AAB6D6C57348A19AECE12F5346E67E691BC5BD4B6DD2BA26CBB12AA53D5D79326B20F82622B132DC585022C28A8C93621303048101958DFF005E1EC6AF532B32BA9427F466A4249ABA2D5DFE500E136211545421086EA13420591D4A6A4ACC7EA2963718A1B2DDB26AE2DFA10656D74FE1775D98DC363E528DDD393F58AD8931127E1B6FF0B763A7E14A2961A1EAAE6863D2ADE999D9790EA5D1CC4718E575A27FD2C8F29936E57E8ED667A13A51ECBEC8E1F36FDCE22DF2D4EBEA4F6E170815F1F39CE5A65A1AC4846335A7D9B117B457C4514D3F51FC235DA55293F925B7B123454C927A71738F46AECD6F1B63E5A3333EB5A3A9BFA8037F401D16D98DA2971D55BD3A70FC534BEC6753A76FB1778ED79293ED34568F4307CB4DFA34FC6C56B611362650C6639C7651DDED77CB731AB8B93D1AF27A5B198B93AB521463CA4D6A7D51D2C786E836D4949D92DEEC1C3D9428294E4D4A6DA775BDBD8DF8A3A4C4C58F04D98193912E5D1855B8670E979617767BB6D9C2E1EB3A3526945E9D5BC6DCBD51EB3638FE2CCB1539AAF15B3B29AFF24F7E347874263654B96A452C362E33574D7B1653339E5F1979A1E5BF6E40FD5EB2E5339CB6A8EFD9BF096D1A44188C5C21CDAF6B949D0C43F9902196A5E6A8EEC6C6A82F6C91B05472AC9A4BCBD2FDCB5848BA71B4BA752BCEBD4BDA10DBA74195F17517FA90DBBC6E4AE2E4B486A66942AA7C98F523229E1A353784DAF4B92AC1D55CAA7DC8A54C57D8E349B23A9552576D147F53ADD6A2FA0E86597DE726FD2E228417B6291E231EE4B4D34DBEE4F82C235E69EEDF72CD2A3182B45587DC5958B5A88D652CCD7974AE6F6476394D170A308FF0A399CB30EEB6263DA176FDCECA32B6C6C78EA5F1D9CFF90B7BD09C8E638D30CE54E3A579B56CFF00B9D2D595B7670D9FE752AD374A9A5A62F69DDDEFC8BF9324A3D94B156E60CA714E717AB9C5D9D8B854CBF0CE11DF9BDD96CE5AF69CF68EA684F8F6297229650BFEEDF7D3FE5175A19C3D47557A953A2F2AF72EF8D5FF0066CA59F2E8E877EC22511D2ECC3E8C6E2FC5A9F87452F3B6A5ED6208DF6B91E62EF8E9DFE58A51FB922673BE525FBE8D8F1CBF4148AB5E0A5168B339591912C4C96B696FD119F427B2FDCFA3ACE09AFAA8B8BF964D5FD11D14A072BFA3FA8DD39FBDDAEC752D9D5E3770395C893E6C5A4AD8EC346AC2509726ADFF00D2C5C6A659925AD11464D3D9C056A72C2CFC29FC3F2CFA7B32EC5DF73A6CD32F856838CD2F47D8E36AC2A61E5A2AFC1F2CFF00C1839F88F7B89B78997F4CB88A129F892D3DB99762FB147070B4E6FD4C98C75BD9AF196D1722AC3A514F9A13604C8D363FD9978AC23A6F5C39755E85FC3D6D714C92A4534EE56C0D1D175D3A134A7CA3DFB14B43921AC726576289A2BE2ABE857EEEC4F5256577C8AF94E15E2EB5FF00DB877EAFD0B38D4BB248A9957FC713A3C830DA21A9ADE4AECD360846CADD827554C38C52396BA6E527B20C4C1B4D7A33CD696215194E325796A6EDF53D3E6F63CEF30C2C258AA975BBE457CA8ED7658C2FF46860B11AE372722C2D1505644A73162FDBA3A8AFD09B1FC355BFD44A3F3BB9155A8A2AEF91370A52F2CE7F8A4DA34FC5C65C8CEF22D289BF7F4106E03A3E260F231389A83A55557B7965B49AEFD195E8D55249A775E87655E946717192BA7D0E5715C33522EF426AD7BE89723373B07E57B45BC3CCF8D6994EA62A09E96C8EB56A54E3776BFB92E238631159AD7A609758BBB35709C1F4236D4E536BF114EBF1AD32DD9E453441C074A5155676694DED7F43AD4C869538C5698AB2EC879B54D6E0B4635B3E72DA1F2630570961C488054CE3030AD49C24AFB36ADCEFD0B82688E75A92D12572E2F679CE06B4A9CDD29ECE2DE9BF3B17A104AED753478CF2BBC3F5886D2A7BB6BAA32B075B5C232EE91CCF90C775BDA3A3C2B94D687578B6ACB664586A325CD964723354DA5A3506B0587018DD8090E6088DC454515A9F242C56DE88E52D233F1B525566A853F89F3EC91D964597AA14A34FAF393F532385B02939576B79376BF63A5474D8544631D9CEE65F294B426C636176EE3255637B6A8AF768D2E8CB6072391E2DCAA5AA3569BDEE95BB9D7369F54FDB732B88669461DF52239D4A44B5D8E0F68E71D3C4B492A6F6B5D922A9521F1D397D0EAE9C874ACF995BFE3AB65C5E42C471F28D4C43D118B8A7672724CEA3038754E0A2BA2B12BB74483145AA71A157A20BB26767B24B0036016B641C99A76031CD8D6C46B633601315C433886C4200E1DA104386DC2D8BB012610584C4022C647553942D7BA6AC79E64D2D2A54DF384A4ADE97D8F45B1C0E7187743177F96AABDFF8AC66790AF9C0D1C0B78C8B611B00DCE55AD3D1D44649AD8EB80098AE2685DA09933C642A62634652B2EB7EE58C5E651827DD7239DC2606551CAB49BBFCB63431294BF6994B2A4F5A47AD61A946314A3CBA1227D4F2FC8F8DE7424E9578B925CA46D67BC631746D4232727D5A3A08CE3189CFCEA93913F11711B52746924E5D5DF91C1E654EB36E4EA4B576BB2CE4346A4AABA93BB6EF7B9A79DD1B353B73453B32BF7D22DD788B8ED993C29C495A8D78D29C9B8BDB76CF42E259A71835F8933CD305809D7C541423E54D39348F4ACFE928C29AB727146AD4F71D9996AD4B48D4A4B64FD10E0525E55F4113A4440D23D02E14003EE21B610074690DB03509B000850CD40420123E40B8CB8AE003906E32E24C00935098C42B800FB9CA71F4E2A9C23F3392D3DD1D45CE178AAA7898E843F043515327A832CE2FFB449453497B14A798CB5B8C60E56E7A5365AAF3D1172EC8D3E0CC0354E539739D9EFD2C73D8F8EAD93D9BD7DEEB8F461D5CC2C9AD324FB6964D81C4A9ABDF7EABB1DB4A945EFA16FE9FDCE0614DC3155A1FC575F527BF0635C768831F31D92D1979EAB578DFE16D5CDC8535A366AC6767F4149C6FF8E2BE8D9A12E1BC4D2F35292945FCB20856ECAD6BD92DD6A84FB321E48A5535BE46B53C2C124ADF906965B8D96D68C7D5FF00E8B70E16AD3579D7B3ED143BF16E9F4D90BCAA97652D1085DF233B1B57C7B53A49C9F75C8E9A1C1D0697895272FA9B583CA68D2495385BD4B1478F6A5B9156ECDDAFD4CDE14C8961E2DBF89DAEC77153DA0FF8E26E693078A7E18FF347F336631E2B465CA7C997E0F641041FF8131E8408F8918F8009B1FAC42B000365C4C0E478D6278DB192E5534FB233EA710E2E5CEBCFE8EC5D588CAEF211EE6A5EA1523C2167389E7E34FF00A992AE21C5F4AF3FB87E1C86FE423DCAE1678C60B8CF194F9CF57A48D09FE91712D6D08A7DC4786D0E5908F56B8AE78D6238DF192F9F4FB21F966658EACEEEBCA31EAEFB14F217C51DB26A65F23D23D8750E533CC6BD1C43F87153FEA650C43C753DD569BFFC999F1CD83EB65F78534B67AE3670F9B3B63DBEF4D2391C3E67994E5655A4BDD9B386C15672552AD4D524BA90E5E447835B27C4C79A96DA34B3697EEA5EC75B94D55E141AE5A572F6394AF1738B8F747315F3FC5E19785195A3D0A3E3A4B9765ECEADF1DA3D7B5EDF4388CCA4BF5DA96FC3138D8F17635FFBAFB1B7C3F1A92BD5A8DB94ADBB3433E7155947060F9EF459CF1DE3BFE28DBEE77D97D46E941FA2FC8F30E28C554835A2DB6E53FF00A838B4B4A5156F4437C6569C76C6F919BE5E8F61D4BAB22AF8DA705794E2BEA8F0FC771562EAFC555AF48EC654F1B37F14E4FDE4CDA8D71FE992EC9FF0F7A971061BAD68FDD0CFFF004786FF009A1F73C2232BF57F764D165B863C645795CCF6F7C4785FF9A3F732B3CCFB0938ABD54ECD72F43C9982C39E2219F90CF5EA3C4985B2B545F52F51CCA94FE1A917E899E28872AB25CA4D7B3684FC443BF259EE2ABC7BAFBA04F1D4A3CEA457BC91E22F1B56D6F1256FE66579D493E7293F76C6BC61DF39EE5FB5A8FF00CB0FEA11E1977DFF00BB109F8C1F38F6C098F487246A14F631047D85A45D09C90D1587584C4D06D1055763A2CAF14A4A14E2D2DFCDD0C1B0D516B74EDEA67E6E1FCD1D22EE2E47C4CEE6BD57AD5383DB6DD9A11C3BB59B386CAF379527769BF73661C5ABAC5FB9C9E578BBA0FF00547474F92A9AECE8A14522689CFCB8A2973DDFB0A1C4F49DB9A283C0BDFB45D8E75297B3A2B985C4F5E1A2DB5DFB15B30E248A8F9377F91CBE271B2A8EF26CB389E3ADE49E8AF93E46AE3A3A7C872C85B54927EE74B4925B2565E871194677E1F96576B6FA1D660F1719EF17EA267E2DB17DFA170722B92E87E3B0AA6B91832E158C9DDBFB1D1CAAA4452C643F12FB94A99DD15A8976D554BFD18B4B86292B5F7F71B8CC8A825CADEA5ECD31B151D5192BA7D0871D57551BBED72DC2590DEDB2B4E146BA391CCB00E8CBBC5F2643195CB59AE314E308AE6B994E275DE31CDC7F6394CD5153FD47882268D72882E01D603001A21D61691BC4363443EC2178A1DB1D6081B15C93447DB08182E0602683A84D89A1585146A15C7A4092062A6340E0390864A298BC9A237006826680911FC317F4394DFF0048BC21DA0780454A40E4C638963058FA949DE2FE844C6B23B716162FD896ABE55BE996F179CD5A9CF65E854D527F33FB80299043C7D31FA259E65B2FB049CBF13FB9354C6549474B96DD88C5625FC2ABF847F9367F48E34C7A43EC22C42A8C3D10B937DB006E0601E3437100402045A856134002B8802002490D10878A8082C420063842100C0A048421017B18C7210818AC4C4B904402A1821086C804C6B1084428D1084398F1E142102F486B1C04210A340C0210D63908421008C2C42100801084007FFFD9,\r\n'username',\r\n'default@default.com',\r\nHASHBYTES('SHA2_512','password'),\r\n'user',\r\n0);");
            Update("Insert into Account\r\n(Propic, Username, Email, Psw, Ruolo, PFedelta)\r\nValues \r\n(0xFFD8FFE000104A46494600010100000100010000FFDB00840009060712121215121212151515171712151210101210151515151515161615121515181D2820181A251D151521312125292B2E2E2E171F3338332D37282D2E2B010A0A0A0E0D0E1B10101A2B251F222D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D372B372B372D2D2BFFC000110800E100E103012200021101031101FFC4001B00000105010100000000000000000000000100020304050607FFC4003C100002010204040404020903050100000000010203110405122106314151132261713242819152B107141523627292A1C1334353172482D1E116FFC4001A010001050100000000000000000000000000010203040506FFC40026110002020202020203010003000000000000010203041112210531134114225132152371FFDA000C03010002110311003F00F411086B242D02C14215C0415C6C8235B000A1C32E390083EC0D21466F11E29D3C3D49AE6909E854439971161E86D3A914FB5CAF85E2CC34DA4A6B7EB73C667879E22A39CDB576EC99AB82CB1D2DF9FBA295D92A24F5D0E67AFE3F38A54A9EBD49F6499C1E6FFA499A7A6952BDB9BDCCEAB6704D377E5A6EED7F629C72EDDDA3D4AFF9858FC36747907E905D49AA7561A5B764CF408B4CF13C5E0B4E99A5E68CAFED63D5F20CC154A51BB4A5649ABFA162AC95221BB15C16CD5681623AD5947793B069D64F93D8B89FDA2A324044221E341705C4040204CECEE56A6EE683327892FE0BB778FE602A2CD0F857D09910D1F857B22410B0BD0F424350E88031D6102E101A680D6398248068C63641DC160006A0A0582002B0A2C17034001A959455D98B8BC742AEAA329249DCBF8F93B592B9E77C6B4FC3B3553CEDFC30E84364F4858ADB293C2538CE4AF7D3276B334A861A538F9B65D118590C652A894BDDDCED610BA497639CCC9B52E8DEC48FEA7398DC0DA51516F7FEC5DFD97B7C4F5771D884FC64BB234D44AD65AE29175411CDE22535FBB92BEF65263F31A7528C23529C9A9452BAE869E6B04E17DAEAD61894AAC128D36F6DEFC89EBB7D32BDDC75A30EA719D5AAA30973BD9BB247A0E4346A38464E5B33849E4708CAF38B8BBFD3E86D706677A6ACB0F396D7F25CD9C7C9527A4625F535D9DEC589A0442CD24F68A4C084C484C03631AEA67E751FDDFD63F99A467673F07D57E620A8923C905017400A584B487A258914512C00490FB08221466CBCC6B438027A22D806B43EE20D8E4C6A88A511D71AE42392D0BEC6340663679C450A1E55E69F65B9852CD3155775250454B732BADF65AAF1A72FA3ACC754D1094BB2673584E1F588B55AAAF7BB4BD3A19B8FAF8AF0E5AAA268D3CA73EA73A4A0AA689256DFB99B9592EC5B813C6870F652CFF21742709D18D93D9ABF225C4D1C4D3A6A4E8EA4D2DE0EE5BA78F552F4710EE9FC3345FC147154A36A528D5825B465D8CE8CD49EA64AA538FA38B93ACAAC65E04FCCB64F635BF67E3A72515474A76DE5D0399666E559C7132706ADA14392F42EE499AE3251968B4A37F2CA7CEC5C70AF5E81DD615338C83C18454E7AAA4DA4A29FDD9BF89953C2E1D3B5DD924BBB2854FDDDAB6227AAA2F8629DED7E88CD8E3275EA46535E44EF18B29CDA7FF82FC7397668E71055F0ADCA293B370E8D58F30C3BA94EBC2A37D52BFA5CEEF3CCDEA49385AD0EF6E87338DC6D19C7C34BCE9AB48B389394073A1B8E99EA5431D4FC38B72B5D75688AA67B878F3A88E2F078194E2BC49B6ADB24CB54B05087CB7F7DCB13F25C7A238F8FDFB3ACA59DD096CAA2FA972155495E2D3F6387AB9741EFA6DEDD014B13570AD4B53943969EC3A9F26A52D3196F8F715B477865E79B417F322DE598F856829C5DD755D9FA9578857EED7F344D685B192D99EEB947D922E9EC8361B0E4BD90E44C48BD0F812C48A0491602487EAF408840465FB0DB0F18C19101B004A398E650A29CA6D2DB657219CD47D8F841C9F45A9C8E678A338946D469CAD293B3DBA142AF10626B7C09421D24F9B2A52C249D575272D4FB999939A945A8B3531F11F2DB1F87C028EEFCD27BB93DCB7142B8D9339C959293ED9BF1AA290CC4D3D5171F73858E0AA46BD9773AC9D7A8DDA0ADEA08E54E4F54E7B9771ECF893E5F645652A44D0A6A518A9735D50EA54EAC5F92AC92F720964FDA7220961B110F85EA43769FA61F12D7A2DFEC8527294E5A9BEAFA325852AAA3A555697644584CC92F2C938BECC9AB6252E5BBEC88DCAC4F40A98FDA151A1A5DDBD4FBB64B89ACA2AEF6B762BA85496F7B7A1253C1AB35257F718DF7DB2555E9745396654AA4249BB73E673D9265A9D572E899D5BCB697E05EFB917ECD8C5DE3B7DCB31C88462D47EC6BAB6FB2E538D90E1B1561C8A126F64AA292134475A9A92B324624353D3D84A29A31B0D86AB194A30A8E2B9A4B91354FD6E31BF88A4B6F2BF434F4A158BB1CD9C59567891921B9767F193D134E33D959FF00837E0CE5B17808CF7EBD25D6E5BC87346EF0A8FCD17B5F9B46D61E7AB3A66664E22AFB4745164912184AE488D75E8CE9224B086EB10119AAC6B09063710A11726F921B63E88A0B6CA3996754A927796E96E8E37C5962EA3AB51F916D0874F722A70F16AD49CB74E575D8D2A74F4AB2D8C1CDCAD746DE2627DB428C3A212A3BB77FA0FB053E661FC8DBD9B0ABD0C7249D9BDC758CFC6CBF7B0F734131671D24C962051F41C209136C50213081A1622143339452DD2BFB0FC1E1ACAF6DD9573277A908FD4D58966CDC608022104AAD8A36E26160D21B01B7021CD15B1751C527EA3E2B90169A00D84EE83711AD0043A46B7D46D3AB7BD834C091A29E3F0EB4CA51DA56DA4B996C6C912556384B688AC827126E13C6EB8696EF25CEE6F44E13112951A8AA53DADF125D5763B1CBF16AA42335D4EB30EFE7139CC9A9C645BBA10AE02EECADA35AE70DC4D98CAAD6F020FCB1BEAB1D4E778CF068CA77DEDB7B9C565506D4A72F8A4DC9BF729790BB8409F06AE73ECB7429A8C524496124168E4676393DB3A68C5457401AD10E3EBB846EBD096136D27B5EDDD0AAB6D6C57348A19AECE12F5346E67E691BC5BD4B6DD2BA26CBB12AA53D5D79326B20F82622B132DC585022C28A8C93621303048101958DFF005E1EC6AF532B32BA9427F466A4249ABA2D5DFE500E136211545421086EA13420591D4A6A4ACC7EA2963718A1B2DDB26AE2DFA10656D74FE1775D98DC363E528DDD393F58AD8931127E1B6FF0B763A7E14A2961A1EAAE6863D2ADE999D9790EA5D1CC4718E575A27FD2C8F29936E57E8ED667A13A51ECBEC8E1F36FDCE22DF2D4EBEA4F6E170815F1F39CE5A65A1AC4846335A7D9B117B457C4514D3F51FC235DA55293F925B7B123454C927A71738F46AECD6F1B63E5A3333EB5A3A9BFA8037F401D16D98DA2971D55BD3A70FC534BEC6753A76FB1778ED79293ED34568F4307CB4DFA34FC6C56B611362650C6639C7651DDED77CB731AB8B93D1AF27A5B198B93AB521463CA4D6A7D51D2C786E836D4949D92DEEC1C3D9428294E4D4A6DA775BDBD8DF8A3A4C4C58F04D98193912E5D1855B8670E979617767BB6D9C2E1EB3A3526945E9D5BC6DCBD51EB3638FE2CCB1539AAF15B3B29AFF24F7E347874263654B96A452C362E33574D7B1653339E5F1979A1E5BF6E40FD5EB2E5339CB6A8EFD9BF096D1A44188C5C21CDAF6B949D0C43F9902196A5E6A8EEC6C6A82F6C91B05472AC9A4BCBD2FDCB5848BA71B4BA752BCEBD4BDA10DBA74195F17517FA90DBBC6E4AE2E4B486A66942AA7C98F523229E1A353784DAF4B92AC1D55CAA7DC8A54C57D8E349B23A9552576D147F53ADD6A2FA0E86597DE726FD2E228417B6291E231EE4B4D34DBEE4F82C235E69EEDF72CD2A3182B45587DC5958B5A88D652CCD7974AE6F6476394D170A308FF0A399CB30EEB6263DA176FDCECA32B6C6C78EA5F1D9CFF90B7BD09C8E638D30CE54E3A579B56CFF00B9D2D595B7670D9FE752AD374A9A5A62F69DDDEFC8BF9324A3D94B156E60CA714E717AB9C5D9D8B854CBF0CE11DF9BDD96CE5AF69CF68EA684F8F6297229650BFEEDF7D3FE5175A19C3D47557A953A2F2AF72EF8D5FF0066CA59F2E8E877EC22511D2ECC3E8C6E2FC5A9F87452F3B6A5ED6208DF6B91E62EF8E9DFE58A51FB922673BE525FBE8D8F1CBF4148AB5E0A5168B339591912C4C96B696FD119F427B2FDCFA3ACE09AFAA8B8BF964D5FD11D14A072BFA3FA8DD39FBDDAEC752D9D5E3770395C893E6C5A4AD8EC346AC2509726ADFF00D2C5C6A659925AD11464D3D9C056A72C2CFC29FC3F2CFA7B32EC5DF73A6CD32F856838CD2F47D8E36AC2A61E5A2AFC1F2CFF00C1839F88F7B89B78997F4CB88A129F892D3DB99762FB147070B4E6FD4C98C75BD9AF196D1722AC3A514F9A13604C8D363FD9978AC23A6F5C39755E85FC3D6D714C92A4534EE56C0D1D175D3A134A7CA3DFB14B43921AC726576289A2BE2ABE857EEEC4F5256577C8AF94E15E2EB5FF00DB877EAFD0B38D4BB248A9957FC713A3C830DA21A9ADE4AECD360846CADD827554C38C52396BA6E527B20C4C1B4D7A33CD696215194E325796A6EDF53D3E6F63CEF30C2C258AA975BBE457CA8ED7658C2FF46860B11AE372722C2D1505644A73162FDBA3A8AFD09B1FC355BFD44A3F3BB9155A8A2AEF91370A52F2CE7F8A4DA34FC5C65C8CEF22D289BF7F4106E03A3E260F231389A83A55557B7965B49AEFD195E8D55249A775E87655E946717192BA7D0E5715C33522EF426AD7BE89723373B07E57B45BC3CCF8D6994EA62A09E96C8EB56A54E3776BFB92E238631159AD7A609758BBB35709C1F4236D4E536BF114EBF1AD32DD9E453441C074A5155676694DED7F43AD4C869538C5698AB2EC879B54D6E0B4635B3E72DA1F2630570961C488054CE3030AD49C24AFB36ADCEFD0B82688E75A92D12572E2F679CE06B4A9CDD29ECE2DE9BF3B17A104AED753478CF2BBC3F5886D2A7BB6BAA32B075B5C232EE91CCF90C775BDA3A3C2B94D687578B6ACB664586A325CD964723354DA5A3506B0587018DD8090E6088DC454515A9F242C56DE88E52D233F1B525566A853F89F3EC91D964597AA14A34FAF393F532385B02939576B79376BF63A5474D8544631D9CEE65F294B426C636176EE3255637B6A8AF768D2E8CB6072391E2DCAA5AA3569BDEE95BB9D7369F54FDB732B88669461DF52239D4A44B5D8E0F68E71D3C4B492A6F6B5D922A9521F1D397D0EAE9C874ACF995BFE3AB65C5E42C471F28D4C43D118B8A7672724CEA3038754E0A2BA2B12BB74483145AA71A157A20BB26767B24B0036016B641C99A76031CD8D6C46B633601315C433886C4200E1DA104386DC2D8BB012610584C4022C647553942D7BA6AC79E64D2D2A54DF384A4ADE97D8F45B1C0E7187743177F96AABDFF8AC66790AF9C0D1C0B78C8B611B00DCE55AD3D1D44649AD8EB80098AE2685DA09933C642A62634652B2EB7EE58C5E651827DD7239DC2606551CAB49BBFCB63431294BF6994B2A4F5A47AD61A946314A3CBA1227D4F2FC8F8DE7424E9578B925CA46D67BC631746D4232727D5A3A08CE3189CFCEA93913F11711B52746924E5D5DF91C1E654EB36E4EA4B576BB2CE4346A4AABA93BB6EF7B9A79DD1B353B73453B32BF7D22DD788B8ED993C29C495A8D78D29C9B8BDB76CF42E259A71835F8933CD305809D7C541423E54D39348F4ACFE928C29AB727146AD4F71D9996AD4B48D4A4B64FD10E0525E55F4113A4440D23D02E14003EE21B610074690DB03509B000850CD40420123E40B8CB8AE003906E32E24C00935098C42B800FB9CA71F4E2A9C23F3392D3DD1D45CE178AAA7898E843F043515327A832CE2FFB449453497B14A798CB5B8C60E56E7A5365AAF3D1172EC8D3E0CC0354E539739D9EFD2C73D8F8EAD93D9BD7DEEB8F461D5CC2C9AD324FB6964D81C4A9ABDF7EABB1DB4A945EFA16FE9FDCE0614DC3155A1FC575F527BF0635C768831F31D92D1979EAB578DFE16D5CDC8535A366AC6767F4149C6FF8E2BE8D9A12E1BC4D2F35292945FCB20856ECAD6BD92DD6A84FB321E48A5535BE46B53C2C124ADF906965B8D96D68C7D5FF00E8B70E16AD3579D7B3ED143BF16E9F4D90BCAA97652D1085DF233B1B57C7B53A49C9F75C8E9A1C1D0697895272FA9B583CA68D2495385BD4B1478F6A5B9156ECDDAFD4CDE14C8961E2DBF89DAEC77153DA0FF8E26E693078A7E18FF347F336631E2B465CA7C997E0F641041FF8131E8408F8918F8009B1FAC42B000365C4C0E478D6278DB192E5534FB233EA710E2E5CEBCFE8EC5D588CAEF211EE6A5EA1523C2167389E7E34FF00A992AE21C5F4AF3FB87E1C86FE423DCAE1678C60B8CF194F9CF57A48D09FE91712D6D08A7DC4786D0E5908F56B8AE78D6238DF192F9F4FB21F966658EACEEEBCA31EAEFB14F217C51DB26A65F23D23D8750E533CC6BD1C43F87153FEA650C43C753DD569BFFC999F1CD83EB65F78534B67AE3670F9B3B63DBEF4D2391C3E67994E5655A4BDD9B386C15672552AD4D524BA90E5E447835B27C4C79A96DA34B3697EEA5EC75B94D55E141AE5A572F6394AF1738B8F747315F3FC5E19785195A3D0A3E3A4B9765ECEADF1DA3D7B5EDF4388CCA4BF5DA96FC3138D8F17635FFBAFB1B7C3F1A92BD5A8DB94ADBB3433E7155947060F9EF459CF1DE3BFE28DBEE77D97D46E941FA2FC8F30E28C554835A2DB6E53FF00A838B4B4A5156F4437C6569C76C6F919BE5E8F61D4BAB22AF8DA705794E2BEA8F0FC771562EAFC555AF48EC654F1B37F14E4FDE4CDA8D71FE992EC9FF0F7A971061BAD68FDD0CFFF004786FF009A1F73C2232BF57F764D165B863C645795CCF6F7C4785FF9A3F732B3CCFB0938ABD54ECD72F43C9982C39E2219F90CF5EA3C4985B2B545F52F51CCA94FE1A917E899E28872AB25CA4D7B3684FC443BF259EE2ABC7BAFBA04F1D4A3CEA457BC91E22F1B56D6F1256FE66579D493E7293F76C6BC61DF39EE5FB5A8FF00CB0FEA11E1977DFF00BB109F8C1F38F6C098F487246A14F631047D85A45D09C90D1587584C4D06D1055763A2CAF14A4A14E2D2DFCDD0C1B0D516B74EDEA67E6E1FCD1D22EE2E47C4CEE6BD57AD5383DB6DD9A11C3BB59B386CAF379527769BF73661C5ABAC5FB9C9E578BBA0FF00547474F92A9AECE8A14522689CFCB8A2973DDFB0A1C4F49DB9A283C0BDFB45D8E75297B3A2B985C4F5E1A2DB5DFB15B30E248A8F9377F91CBE271B2A8EF26CB389E3ADE49E8AF93E46AE3A3A7C872C85B54927EE74B4925B2565E871194677E1F96576B6FA1D660F1719EF17EA267E2DB17DFA170722B92E87E3B0AA6B91832E158C9DDBFB1D1CAAA4452C643F12FB94A99DD15A8976D554BFD18B4B86292B5F7F71B8CC8A825CADEA5ECD31B151D5192BA7D0871D57551BBED72DC2590DEDB2B4E146BA391CCB00E8CBBC5F2643195CB59AE314E308AE6B994E275DE31CDC7F6394CD5153FD47882268D72882E01D603001A21D61691BC4363443EC2178A1DB1D6081B15C93447DB08182E0602683A84D89A1585146A15C7A4092062A6340E0390864A298BC9A237006826680911FC317F4394DFF0048BC21DA0780454A40E4C638963058FA949DE2FE844C6B23B716162FD896ABE55BE996F179CD5A9CF65E854D527F33FB80299043C7D31FA259E65B2FB049CBF13FB9354C6549474B96DD88C5625FC2ABF847F9367F48E34C7A43EC22C42A8C3D10B937DB006E0601E3437100402045A856134002B8802002490D10878A8082C420063842100C0A048421017B18C7210818AC4C4B904402A1821086C804C6B1084428D1084398F1E142102F486B1C04210A340C0210D63908421008C2C42100801084007FFFD9,\r\n'username',\r\n'admin@default.com',\r\nHASHBYTES('SHA2_512','ciao'),\r\n'admin',\r\n0);");
        }
        public bool InsertSandalo(string nome, string marca, string query, string descrizione, double? prezzo, string categoria, string genere, double? sconto, int? quantita, int? taglia, System.Data.SqlTypes.SqlBinary immagineSqlBinary1, System.Data.SqlTypes.SqlBinary immagineSqlBinary2, System.Data.SqlTypes.SqlBinary immagineSqlBinary3, System.Data.SqlTypes.SqlBinary immagineSqlBinary4, string sku, string colore)
        {
            try
            {
                Connection.Open();

                SqlCommand cmd = new SqlCommand(query, Connection);

                // Aggiungi i parametri per le immagini binarie (immagine1, immagine2, ecc.)
                cmd.Parameters.Add("@Immagine1", SqlDbType.VarBinary).Value = immagineSqlBinary1;
                cmd.Parameters.Add("@Immagine2", SqlDbType.VarBinary).Value = immagineSqlBinary2;
                cmd.Parameters.Add("@Immagine3", SqlDbType.VarBinary).Value = immagineSqlBinary3;
                cmd.Parameters.Add("@Immagine4", SqlDbType.VarBinary).Value = immagineSqlBinary4;

                // Aggiungi tutti gli altri parametri, gestendo i valori null
                cmd.Parameters.Add("@Sku", SqlDbType.NVarChar).Value = sku ?? (object)DBNull.Value;
                cmd.Parameters.Add("@Colore", SqlDbType.NVarChar).Value = colore ?? (object)DBNull.Value;
                cmd.Parameters.Add("@nome", SqlDbType.NVarChar).Value = nome ?? (object)DBNull.Value;
                cmd.Parameters.Add("@marca", SqlDbType.NVarChar).Value = marca ?? (object)DBNull.Value;
                cmd.Parameters.Add("@descrizione", SqlDbType.NVarChar).Value = descrizione ?? (object)DBNull.Value;
                cmd.Parameters.Add("@categoria", SqlDbType.NVarChar).Value = categoria ?? (object)DBNull.Value;
                cmd.Parameters.Add("@genere", SqlDbType.NVarChar).Value = genere ?? (object)DBNull.Value;
                cmd.Parameters.Add("@prezzo", SqlDbType.Decimal).Value = prezzo ?? (object)DBNull.Value;
                cmd.Parameters.Add("@sconto", SqlDbType.Decimal).Value = sconto ?? (object)DBNull.Value;
                cmd.Parameters.Add("@quantita", SqlDbType.Int).Value = quantita ?? (object)DBNull.Value;
                cmd.Parameters.Add("@taglia", SqlDbType.Int).Value = taglia ?? (object)DBNull.Value;


                int affette = cmd.ExecuteNonQuery();

                return affette > 0;
            }
            catch (SqlException e)
            {
                Console.WriteLine(e.Message);
                Console.WriteLine($"\nQUERY ERRATA:\n{query}");

                return false;
            }
            catch (Exception e)
            {
                Console.WriteLine("Errore generico" + "\n" + e.Message);
                return false;
            }
            finally
            {
                Connection.Close();
            }
        }
    }
}
